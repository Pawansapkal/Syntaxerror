
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParkSense Dashboard</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-dark: #0f172a;
            --bg-gray: #f3f4f6;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { background-color: var(--bg-gray); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- Header --- */
        header {
            background-color: var(--primary-dark);
            color: white;
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 20;
        }
        .brand { display: flex; align-items: center; gap: 12px; }
        .logo-icon { background: rgba(255,255,255,0.15); padding: 8px; border-radius: 8px; display: flex; }
        .brand-text h1 { font-size: 1.1rem; font-weight: 700; letter-spacing: -0.5px; }
        .brand-text p { font-size: 0.75rem; opacity: 0.7; font-weight: 500; }
        
        /* City Selector */
        .city-container { position: relative; }
        .city-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex; align-items: center; gap: 8px;
            transition: background 0.2s;
        }
        .city-btn:hover { background: rgba(255,255,255,0.2); }
        
        .city-menu {
            display: none; /* Hidden by default */
            position: absolute;
            top: 120%; right: 0;
            background: white;
            color: #1f2937;
            width: 200px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 8px;
            z-index: 50;
            border: 1px solid #e5e7eb;
        }
        .city-menu.show { display: block; }
        .city-menu input {
            width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 4px; margin-bottom: 8px; font-size: 0.85rem;
        }
        .city-option {
            padding: 8px; border-radius: 4px; cursor: pointer; font-size: 0.9rem;
        }
        .city-option:hover { background: #f3f4f6; }

        /* --- Dashboard Layout --- */
        .dashboard-container {
            flex: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }
        .stat-card {
            background: white;
            padding: 1.25rem;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid #fff;
        }
        .stat-icon { width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .stat-icon.yellow { background: #fffbeb; color: #d97706; }
        .stat-icon.red { background: #fef2f2; color: #dc2626; }
        .stat-icon.orange { background: #fff7ed; color: #ea580c; }
        .stat-icon.blue { background: #eff6ff; color: #2563eb; }

        .stat-info h3 { font-size: 0.75rem; color: #64748b; font-weight: 600; text-transform: uppercase; margin-bottom: 4px; }
        .stat-info .value { font-size: 1.75rem; font-weight: 700; color: #0f172a; line-height: 1; }
        .stat-info .sub { font-size: 0.85rem; color: #94a3b8; font-weight: 500; margin-left: 4px; }

        /* Main Content Split */
        .content-split {
            display: grid;
            grid-template-columns: 2.5fr 1fr; /* Map gets more space */
            gap: 1.5rem;
            flex: 1;
            min-height: 0; /* Important for flex/grid nesting */
        }

        /* --- Map Section --- */
        .map-wrapper {
            background: white; border-radius: 16px; overflow: hidden;
            box-shadow: var(--card-shadow); position: relative; border: 4px solid white;
            height: 100%; min-height: 400px;
        }
        #map { height: 100%; width: 100%; background: #e5e7eb; }

        /* Map Overlays */
        .map-overlay-label {
            position: absolute; top: 20px; left: 20px; 
            background: white; padding: 12px 16px;
            border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 400;
        }
        .map-overlay-label h4 { font-size: 0.95rem; font-weight: 800; color: #1f2937; text-transform: uppercase; letter-spacing: 0.5px; }
        .map-overlay-label span { font-size: 0.75rem; color: #6b7280; font-weight: 600; }

        .legend {
            position: absolute; bottom: 25px; right: 25px; 
            background: white; padding: 12px;
            border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 400; width: 220px;
        }
        .legend-title { font-size: 0.7rem; color: #6b7280; margin-bottom: 8px; font-weight: 700; text-transform: uppercase; }
        .gradient-bar { height: 8px; background: linear-gradient(to right, #10b981, #f59e0b, #ef4444); border-radius: 4px; margin-bottom: 6px; }
        .legend-labels { display: flex; justify-content: space-between; font-size: 0.7rem; color: #4b5563; font-weight: 600; }

        /* Custom Markers */
        .custom-marker-bubble {
            background: white; border: 3px solid; border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s;
        }
        .custom-marker-bubble:hover { transform: scale(1.15); z-index: 1000 !important; }
        .bubble-val { font-size: 13px; font-weight: 800; line-height: 1; color: #333; }
        .bubble-label { font-size: 7px; font-weight: 700; text-transform: uppercase; color: #666; margin-top: 1px; }

        /* --- Right Sidebar --- */
        .sidebar {
            background: white; border-radius: 16px; padding: 1.5rem;
            box-shadow: var(--card-shadow); border: 1px solid white;
            display: flex; flex-direction: column; gap: 1.5rem;
            height: 100%;
        }

        .toggle-row { display: flex; justify-content: space-between; align-items: center; }
        .toggle-label { font-weight: 700; color: #1f2937; display: flex; align-items: center; gap: 10px; font-size: 1rem; }
        
        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 48px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: var(--primary-dark); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Simulate Button */
        #simBtn {
            width: 100%; padding: 12px;
            background: white; border: 1px solid #ef4444; color: #ef4444;
            border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: all 0.2s;
        }
        #simBtn:hover { background: #fef2f2; }
        #simBtn.active { background: #ef4444; color: white; border-color: #ef4444; }

        /* Insight Progress Bars */
        .insight-section h4 { font-size: 0.75rem; font-weight: 700; color: #64748b; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .insight-item { margin-bottom: 16px; }
        .insight-header { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 6px; color: #334155; font-weight: 600; }
        .insight-status { font-weight: 700; }
        .status-high { color: #dc2626; }
        .status-critical { color: #b91c1c; }
        .status-med { color: #d97706; }

        .progress-bg { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 4px; width: 0; transition: width 1s ease-out; }

        .rec-box { margin-top: auto; padding-top: 1rem; border-top: 1px solid #e2e8f0; }
        .rec-box p { font-size: 0.8rem; color: #475569; line-height: 1.5; }
        .rec-box strong { color: #1e293b; }

        /* Animations */
        .heat-glow { filter: blur(35px); opacity: 0.6; animation: pulse 4s infinite; }
        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 0.7; } 100% { opacity: 0.4; } }

        @media (max-width: 1024px) {
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .content-split { grid-template-columns: 1fr; }
            .sidebar { height: auto; }
            #map { height: 350px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <div class="logo-icon"><i data-lucide="map-pin" color="white" size="20"></i></div>
            <div class="brand-text">
                <h1>ParkSense</h1>
                <p>Smart City Dashboard</p>
            </div>
        </div>

        <div class="city-container">
            <button onclick="toggleCityMenu()" class="city-btn">
                <i data-lucide="globe" size="14"></i> 
                <span id="currentCity">Melbourne</span>
                <i data-lucide="chevron-down" size="14"></i>
            </button>
            <div id="cityMenu" class="city-menu">
                <input type="text" id="citySearch" placeholder="Search city..." onkeyup="filterCity()" />
                <div class="city-option" onclick="selectCity('Melbourne')">Melbourne</div>
                <div class="city-option" onclick="selectCity('Sydney')">Sydney</div>
                <div class="city-option" onclick="selectCity('Mumbai')">Mumbai</div>
                <div class="city-option" onclick="selectCity('New York')">New York</div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon yellow"><i data-lucide="bar-chart-2"></i></div>
                <div class="stat-info">
                    <h3>Current Availability</h3>
                    <span class="value" id="val-avail">38%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon red"><i data-lucide="trending-down"></i></div>
                <div class="stat-info">
                    <h3>Predicted (30 min)</h3>
                    <span class="value" id="val-pred">27%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange"><i data-lucide="activity"></i></div>
                <div class="stat-info">
                    <h3>Parking Stress Index</h3>
                    <span class="value" id="val-psi" style="color: #ea580c">58</span><span class="sub">/100</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon blue"><i data-lucide="shield-check"></i></div>
                <div class="stat-info">
                    <h3>Confidence Level</h3>
                    <span class="value" style="color: #2563eb; font-size: 1.5rem;">High</span>
                </div>
            </div>
        </div>

        <div class="content-split">
            
            <div class="map-wrapper">
                <div id="map"></div>
                <div class="map-overlay-label">
                    <h4 id="mapLabel">Melbourne</h4>
                    <span>Parking Stress Heatmap</span>
                </div>
                <div class="legend">
                    <div class="legend-title">Stress Intensity</div>
                    <div class="gradient-bar"></div>
                    <div class="legend-labels">
                        <span>Available</span>
                        <span>Filling</span>
                        <span>Full</span>
                    </div>
                </div>
            </div>

            <aside class="sidebar">
                <div class="toggle-row">
                    <div class="toggle-label">
                        <i data-lucide="shield-alert" size="20" color="#1e293b"></i>
                        Authority Insight Mode
                    </div>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <button id="simBtn" onclick="toggleSimulation()">
                    <i data-lucide="zap" size="16"></i> Simulate Event
                </button>

                <div class="insight-section">
                    <h4>Why is PSI High?</h4>
                    
                    <div class="insight-item">
                        <div class="insight-header">
                            <span>Peak office hours</span>
                            <span class="insight-status status-high">High</span>
                        </div>
                        <div class="progress-bg"><div class="progress-fill" style="width: 75%; background: #ef4444;"></div></div>
                    </div>

                    <div class="insight-item">
                        <div class="insight-header">
                            <span>Heavy traffic inflow</span>
                            <span class="insight-status status-high">High</span>
                        </div>
                        <div class="progress-bg"><div class="progress-fill" style="width: 65%; background: #ef4444;"></div></div>
                    </div>

                    <div class="insight-item">
                        <div class="insight-header">
                            <span>Event nearby</span>
                            <span class="insight-status status-critical" id="event-status-text">Low</span>
                        </div>
                        <div class="progress-bg"><div class="progress-fill" id="event-bar" style="width: 10%; background: #10b981;"></div></div>
                    </div>
                    
                    <div class="insight-item">
                        <div class="insight-header">
                            <span>Two-wheeler density</span>
                            <span class="insight-status status-med">Med</span>
                        </div>
                        <div class="progress-bg"><div class="progress-fill" style="width: 45%; background: #f59e0b;"></div></div>
                    </div>
                </div>

                <div class="rec-box">
                    <p><strong>Recommendation:</strong> Divert traffic from CG Road to Riverfront Parking A & B to alleviate congestion.</p>
                </div>
            </aside>

        </div>
    </div>

    <script>
        lucide.createIcons();

        // 1. Map Initialization
        const map = L.map('map', {
            zoomControl: false,
            attributionControl: false
        }).setView([-37.8136, 144.9631], 14);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
        L.control.zoom({ position: 'bottomleft' }).addTo(map);

        // 2. Data & Rendering
        const parkingSpots = [
            { name: "Fed Square", coords: [-37.8180, 144.9691], avail: 65, color: '#10b981' }, 
            { name: "Queen Vic Mkt", coords: [-37.8076, 144.9568], avail: 58, color: '#10b981' }, 
            { name: "Crown Casino", coords: [-37.8236, 144.9583], avail: 12, color: '#ef4444' }, 
            { name: "Docklands", coords: [-37.8183, 144.9450], avail: 18, color: '#ef4444' }, 
            { name: "Southbank", coords: [-37.8220, 144.9650], avail: 22, color: '#dc2626' } 
        ];

        // Heatmap Layers
        const heatLayer1 = L.circle([-37.8220, 144.9650], { radius: 800, stroke: false, fillColor: '#ef4444', fillOpacity: 0.4, className: 'heat-glow' }).addTo(map);
        const heatLayer2 = L.circle([-37.8076, 144.9568], { radius: 600, stroke: false, fillColor: '#f59e0b', fillOpacity: 0.4, className: 'heat-glow' }).addTo(map);
        
        // Event Heatmap (Hidden initially)
        let eventLayer = L.circle([-37.8200, 144.9834], { radius: 1200, stroke: false, fillColor: '#7f1d1d', fillOpacity: 0.0, className: 'heat-glow' }).addTo(map);

        // Render Markers
        parkingSpots.forEach(spot => {
            const customIcon = L.divIcon({
                className: 'custom-pin',
                html: `<div class="custom-marker-bubble" style="width: 44px; height: 44px; border-color: ${spot.color}">
                        <span class="bubble-val">${spot.avail}%</span>
                        <span class="bubble-label">Avail</span>
                       </div>`,
                iconSize: [44, 44],
                iconAnchor: [22, 22]
            });
            L.marker(spot.coords, { icon: customIcon }).addTo(map);
        });

        // 3. Logic Functions
        let isSimulating = false;
        
        function toggleSimulation() {
            const btn = document.getElementById('simBtn');
            const psiVal = document.getElementById('val-psi');
            const eventBar = document.getElementById('event-bar');
            const eventText = document.getElementById('event-status-text');
            
            isSimulating = !isSimulating;

            if (isSimulating) {
                // UI: Active State
                btn.classList.add('active');
                btn.innerHTML = `<i data-lucide="loader" class="animate-spin"></i> Event Live...`;
                
                // Stats Update
                psiVal.innerText = "89";
                psiVal.style.color = "#dc2626";

                // Sidebar Update
                eventBar.style.width = "95%";
                eventBar.style.background = "#dc2626";
                eventText.innerText = "Critical";
                eventText.style.color = "#b91c1c";

                // Map Update (Fly to MCG stadium area)
                eventLayer.setStyle({ fillOpacity: 0.6 });
                map.flyTo([-37.8200, 144.9834], 14, { duration: 1.5 });

            } else {
                // UI: Reset State
                btn.classList.remove('active');
                btn.innerHTML = `<i data-lucide="zap"></i> Simulate Event`;
                
                // Stats Reset
                psiVal.innerText = "58";
                psiVal.style.color = "#ea580c";

                // Sidebar Reset
                eventBar.style.width = "10%";
                eventBar.style.background = "#10b981";
                eventText.innerText = "Low";
                eventText.style.color = "#10b981";

                // Map Reset
                eventLayer.setStyle({ fillOpacity: 0.0 });
                map.flyTo([-37.8136, 144.9631], 14, { duration: 1.5 });
            }
            lucide.createIcons();
        }

        /* City Selector Logic */
        function toggleCityMenu() {
            document.getElementById('cityMenu').classList.toggle('show');
        }

        function selectCity(city) {
            document.getElementById('currentCity').innerText = city;
            document.getElementById('mapLabel').innerText = city;
            document.getElementById('cityMenu').classList.remove('show');
            // Mock map move
            if(city === 'Sydney') map.setView([-33.8688, 151.2093], 14);
            if(city === 'Mumbai') map.setView([19.0760, 72.8777], 14);
            if(city === 'Melbourne') map.setView([-37.8136, 144.9631], 14);
        }

        function filterCity() {
            const input = document.getElementById('citySearch');
            const filter = input.value.toUpperCase();
            const div = document.getElementById('cityMenu');
            const options = div.getElementsByClassName('city-option');
            
            for (let i = 0; i < options.length; i++) {
                const txtValue = options[i].textContent || options[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    options[i].style.display = "";
                } else {
                    options[i].style.display = "none";
                }
            }
        }

        // Close menu when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.city-btn') && !event.target.closest('.city-container')) {
                document.getElementById('cityMenu').classList.remove('show');
            }
        }
    </script>
</body>
</html>
