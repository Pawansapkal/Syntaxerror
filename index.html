<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartPark AI | Melbourne Edition</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --primary: #00f2fe;
            --secondary: #4facfe;
            --bg-dark: #0f172a;
            --card-bg: rgba(15, 23, 42, 0.85);
            --text: #f8fafc;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', system-ui, sans-serif; }
        body { background: var(--bg-dark); color: var(--text); height: 100vh; overflow: hidden; }

        /* App Grid */
        .app-container { display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
        @media (max-width: 1024px) { .app-container { grid-template-columns: 1fr; } aside { display: none; } }

        /* Sidebar */
        aside {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            padding: 20px;
            display: flex; flex-direction: column; gap: 20px;
            z-index: 20;
        }

        .logo { 
            font-size: 1.5rem; font-weight: 800; 
            background: linear-gradient(to right, #4facfe, #00f2fe); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            display: flex; align-items: center; gap: 10px;
        }

        .control-group label { font-size: 0.8rem; opacity: 0.7; margin-bottom: 5px; display: block; }
        .control-group input, .control-group select {
            width: 100%; background: var(--glass); border: 1px solid var(--border);
            padding: 8px; border-radius: 6px; color: white; outline: none;
        }

        /* Gradient Button */
        .btn-predict {
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.2s;
        }
        .btn-predict:hover { transform: scale(1.02); }

        /* Map & Overlay */
        main { position: relative; height: 100%; width: 100%; }
        #map { height: 100%; width: 100%; z-index: 1; background: #0a0f1e; }

        /* Custom Gradient Marker Styles */
        .gradient-marker {
            border-radius: 50%;
            box-shadow: 0 0 15px currentColor;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0px rgba(255,255,255,0.4); }
            100% { box-shadow: 0 0 0 20px rgba(255,255,255,0); }
        }

        /* Floating Info Card */
        .info-card {
            position: absolute; top: 20px; left: 20px; width: 280px;
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px);
            border: 1px solid var(--border); border-radius: 15px; padding: 20px;
            z-index: 1000; display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Legend */
        .legend {
            position: absolute; bottom: 20px; right: 20px;
            background: var(--card-bg); padding: 15px; border-radius: 10px;
            z-index: 1000; border: 1px solid var(--border); font-size: 0.8rem;
        }
        .legend div { display: flex; align-items: center; gap: 8px; margin: 5px 0; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

    </style>
</head>
<body>

<div class="app-container">
    <aside>
        <div class="logo"><i data-lucide="map-pin"></i> SmartPark MEL</div>
        
        <div class="control-group">
            <label>Time of Day</label>
            <input type="range" id="timeSlider" min="0" max="23" value="14" oninput="updateLabel(this.value)">
            <div style="text-align: right; font-size: 0.8rem; color: var(--primary);" id="timeLabel">14:00</div>
        </div>

        <div class="control-group">
            <label>Event Mode</label>
            <select id="eventMode">
                <option value="none">No Events</option>
                <option value="mcg">MCG Match Day</option>
                <option value="convention">Convention Ctr</option>
            </select>
        </div>

        <div class="control-group">
            <label>Traffic Density</label>
            <input type="range" id="trafficSlider" min="0" max="100" value="45">
        </div>

        <button class="btn-predict" onclick="runSimulation()">
            <i data-lucide="radar"></i> Predict Zones
        </button>

        <div style="margin-top: auto;">
            <label style="font-size: 0.8rem; opacity: 0.6;">Availability History</label>
            <canvas id="trendChart" height="120"></canvas>
        </div>
    </aside>

    <main>
        <div id="map"></div>
        
        <div class="info-card" id="infoCard">
            <h3 id="zoneName">Federation Square</h3>
            <h1 id="zoneValue" style="font-size: 2.5rem; color: var(--primary); margin: 10px 0;">85%</h1>
            <p style="font-size: 0.8rem; opacity: 0.7;">Confidence: <span id="zoneConf">92%</span></p>
        </div>

        <div class="legend">
            <div><div class="dot" style="background: #00f2fe; box-shadow: 0 0 10px #00f2fe"></div> High (>50%)</div>
            <div><div class="dot" style="background: #facc15; box-shadow: 0 0 10px #facc15"></div> Medium (20-50%)</div>
            <div><div class="dot" style="background: #ef4444; box-shadow: 0 0 10px #ef4444"></div> Low (<20%)</div>
        </div>
    </main>
</div>

<script>
    lucide.createIcons();

    // 1. Initialize Map centered on Melbourne CBD
    const map = L.map('map').setView([-37.8136, 144.9631], 14);

    // Dark Mode Tiles (CartoDB)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '© OpenStreetMap contributors, © CARTO'
    }).addTo(map);

    // 2. Melbourne Data Points
    const zones = [
        { name: "Federation Square", coords: [-37.8180, 144.9691], base: 40 },
        { name: "Queen Victoria Market", coords: [-37.8076, 144.9568], base: 60 },
        { name: "Crown Casino Complex", coords: [-37.8236, 144.9583], base: 20 },
        { name: "Melbourne Central", coords: [-37.8110, 144.9626], base: 30 },
        { name: "Docklands District", coords: [-37.8183, 144.9450], base: 70 },
        { name: "MCG / Yarra Park", coords: [-37.8200, 144.9834], base: 80 }
    ];

    let markersLayer = L.layerGroup().addTo(map);

    // 3. Logic to create Gradient Markers
    function createGradientMarker(lat, lng, availability, name) {
        // Determine color based on availability
        let color = availability > 50 ? '0, 242, 254' : (availability > 20 ? '250, 204, 21' : '239, 68, 68'); // RGB values
        let hexColor = availability > 50 ? '#00f2fe' : (availability > 20 ? '#facc15' : '#ef4444');

        // Custom HTML Icon with CSS Radial Gradient
        const customIcon = L.divIcon({
            className: 'custom-div-icon',
            html: `<div style="
                width: 60px; height: 60px;
                background: radial-gradient(circle, rgba(${color}, 0.6) 0%, rgba(${color}, 0) 70%);
                border-radius: 50%;
                display: flex; justify-content: center; align-items: center;
                box-shadow: 0 0 15px rgba(${color}, 0.4);
                cursor: pointer;
            ">
                <div style="width: 10px; height: 10px; background: white; border-radius: 50%;"></div>
            </div>`,
            iconSize: [60, 60],
            iconAnchor: [30, 30]
        });

        const marker = L.marker([lat, lng], { icon: customIcon }).addTo(markersLayer);
        
        marker.on('click', () => {
            document.getElementById('infoCard').style.display = 'block';
            document.getElementById('zoneName').innerText = name;
            document.getElementById('zoneValue').innerText = availability + '%';
            document.getElementById('zoneValue').style.color = hexColor;
        });
    }

    // 4. Simulation Engine
    function runSimulation() {
        markersLayer.clearLayers();
        const hour = parseInt(document.getElementById('timeSlider').value);
        const eventType = document.getElementById('eventMode').value;
        const traffic = parseInt(document.getElementById('trafficSlider').value);

        let totalAvg = 0;

        zones.forEach(z => {
            let val = z.base;

            // Logic: Night is free, Day is busy
            if(hour > 8 && hour < 18) val -= 20; 
            else val += 20;

            // Logic: Events destroy parking at MCG
            if(eventType === 'mcg' && z.name.includes("MCG")) val -= 60;
            if(eventType === 'convention' && z.name.includes("Crown")) val -= 50;

            // Logic: High traffic reduces all parking
            val -= (traffic * 0.3);

            // Clamp and randomize slightly
            val = Math.max(5, Math.min(95, Math.floor(val + (Math.random() * 10 - 5))));
            
            createGradientMarker(z.coords[0], z.coords[1], val, z.name);
            totalAvg += val;
        });

        updateChart(Math.round(totalAvg / zones.length));
    }

    // 5. Utilities
    function updateLabel(val) {
        document.getElementById('timeLabel').innerText = val + ":00";
    }

    // Chart Setup
    const ctx = document.getElementById('trendChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['1', '2', '3', '4', '5'],
            datasets: [{
                data: [50, 45, 40, 55, 60],
                borderColor: '#00f2fe', borderWidth: 2, pointRadius: 0, tension: 0.4
            }]
        },
        options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });

    function updateChart(val) {
        chart.data.datasets[0].data.shift();
        chart.data.datasets[0].data.push(val);
        chart.update();
    }

    // Init
    runSimulation();
</script>
</body>
</html>
